/*
 *  GMAP3 Plugin for JQuery 
 *  Version   : 4.0
 *  Date      : 2011-08-23
 *  Licence   : GPL v3 : http://www.gnu.org/licenses/gpl.html  
 *  Author    : DEMONTE Jean-Baptiste
 *  Contact   : jbdemonte@gmail.com
 *  Web site  : http://gmap3.net
 *   
 *  Copyright (c) 2010-2011 Jean-Baptiste DEMONTE
 *  All rights reserved.
 *   
 * Redistribution and use in source and binary forms, with or without 
 * modification, are permitted provided that the following conditions are met:
 * 
 *   - Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *   - Redistributions in binary form must reproduce the above 
 *     copyright notice, this list of conditions and the following 
 *     disclaimer in the documentation and/or other materials provided 
 *     with the distribution.
 *   - Neither the name of the author nor the names of its contributors 
 *     may be used to endorse or promote products derived from this 
 *     software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" 
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE 
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR 
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS 
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) 
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE 
 * POSSIBILITY OF SUCH DAMAGE.
 */
(function(a){function b(){var a=[];this.empty=function(){for(var b=0;b<a.length;b++)if(a[b])return!1;return!0},this.add=function(b){a.push(b)},this.addNext=function(b){var c=[],d,e=0;for(d=0;d<a.length;d++){if(!a[d])continue;e==1&&c.push(b),c.push(a[d]),e++}e<2&&c.push(b),a=c},this.get=function(){for(var b=0;b<a.length;b++)if(a[b])return a[b];return!1},this.ack=function(){for(var b=0;b<a.length;b++)if(a[b]){delete a[b];break}this.empty()&&(a=[])}}function c(){var b={};this.add=function(a,c,d){return a=a.toLowerCase(),b[a]||(b[a]=[]),b[a].push({obj:c,tag:o(d,"tag")}),a+"-"+(b[a].length-1)},this.get=function(c,d,e){var f,g,h;c=c.toLowerCase();if(!b[c]||!b[c].length)return null;g=d?b[c].length:-1,h=d?-1:1;for(f=0;f<b[c].length;f++){g+=h;if(b[c][g]){if(e!==undefined)if(b[c][g].tag===undefined||a.inArray(b[c][g].tag,e)<0)continue;return b[c][g].obj}}return null},this.all=function(c,d){var e,f=[];c=c.toLowerCase();if(!b[c]||!b[c].length)return f;for(e=0;e<b[c].length;e++){if(!b[c][e])continue;if(d!==undefined&&(b[c][e].tag===undefined||a.inArray(b[c][e].tag,d)<0))continue;f.push(b[c][e].obj)}return f},this.names=function(){var a,c=[];for(a in b)c.push(a);return c},this.refToObj=function(a){return a=a.split("-"),a.length==2&&b[a[0]]&&b[a[0]][a[1]]?b[a[0]][a[1]].obj:null},this.rm=function(c,d,e){var f,g,h;c=c.toLowerCase();if(!b[c])return!1;if(d!==undefined){if(e){for(f=b[c].length-1;f>=0;f--)if(b[c][f]!==undefined&&b[c][f].tag!==undefined&&a.inArray(b[c][f].tag,d)>=0)break}else for(f=0;f<b[c].length;f++)if(b[c][f]!==undefined&&b[c][f].tag!==undefined&&a.inArray(b[c][f].tag,d)>=0)break}else f=e?b[c].length-1:0;if(f in b[c]){typeof b[c][f].obj.setMap=="function"&&b[c][f].obj.setMap(null),typeof b[c][f].obj.remove=="function"&&b[c][f].obj.remove(),typeof b[c][f].obj.free=="function"&&b[c][f].obj.free(),delete b[c][f].obj;if(d!==undefined){h=[];for(g=0;g<b[c].length;g++)g!==f&&h.push(b[c][g]);b[c]=h}else e?b[c].pop():b[c].shift();return!0}return!1},this.clear=function(a,c,d,e){var f,g,h;if(!a||!a.length){a=[];for(f in b)a.push(f)}else a=z(a);for(g=0;g<a.length;g++)if(a[g]){h=a[g].toLowerCase();if(!b[h])continue;if(c)this.rm(h,e,!0);else if(d)this.rm(h,e,!1);else while(this.rm(h,e,!1));}}}function d(){var b=[],c=[],d=[],e=[],f=!1,g;this.events=function(){for(var a=0;a<arguments.length;a++)c.push(arguments[a])},this.startRedraw=function(){return f?!1:(f=!0,!0)},this.endRedraw=function(){f=!1},this.redraw=function(){var a,b=[],c=this;for(a=0;a<arguments.length;a++)b.push(arguments[a]);this.startRedraw?(g.apply(c,b),this.endRedraw()):setTimeout(function(){c.redraw.apply(c,b)},50)},this.setRedraw=function(a){g=a},this.store=function(a,b,c){d.push({data:a,obj:b,shadow:c})},this.free=function(){for(var a=0;a<c.length;a++)google.maps.event.removeListener(c[a]);c=[],this.freeAll()},this.freeIndex=function(a){typeof d[a].obj.setMap=="function"&&d[a].obj.setMap(null),typeof d[a].obj.remove=="function"&&d[a].obj.remove(),d[a].shadow&&(typeof d[a].shadow.remove=="function"&&d[a].obj.remove(),typeof d[a].shadow.setMap=="function"&&d[a].shadow.setMap(null),delete d[a].shadow),delete d[a].obj,delete d[a].data,delete d[a]},this.freeAll=function(){var a;for(a=0;a<d.length;a++)d[a]&&this.freeIndex(a);d=[]},this.freeDiff=function(b){var c,e,f={},g=[];for(c=0;c<b.length;c++)g.push(b[c].idx.join("-"));for(c=0;c<d.length;c++){if(!d[c])continue;e=a.inArray(d[c].data.idx.join("-"),g),e>=0?f[e]=!0:this.freeIndex(c)}return f},this.add=function(a,c){b.push({latLng:a,marker:c})},this.get=function(a){return b[a]},this.clusters=function(a,c,d){var f=a.getProjection(),g=f.fromLatLngToPoint(new google.maps.LatLng(a.getBounds().getNorthEast().lat(),a.getBounds().getSouthWest().lng())),h,i,j,k,l,m,n,o,p=a.getZoom(),q={},r={},s={},t=[],u,v,w,x,y,z,A=a.getBounds();z=0,y={};for(h=0;h<b.length;h++){if(!A.contains(b[h].latLng))continue;k=f.fromLatLngToPoint(b[h].latLng),q[h]=[Math.floor((k.x-g.x)*Math.pow(2,p)),Math.floor((k.y-g.y)*Math.pow(2,p))],y[h]=!0,z++}if(!d){for(n=0;n<e.length;n++)if(n in y)z--;else break;if(!z)return!1}e=y,y=[];for(h in q)l=q[h][0],m=q[h][1],l in r||(r[l]={}),m in r[l]||(r[l][m]=h,s[h]={},y.push(h)),s[r[l][m]][h]=!0;c=Math.pow(c,2),delete r,n=0;for(;;){while(n<y.length&&!(y[n]in s))n++;if(n==y.length)break;h=y[n],w=q[h][0],x=q[h][1],r=null;do{u={lat:0,lng:0,idx:[]};for(o=n;o<y.length;o++){if(!(y[o]in s))continue;i=y[o];if(Math.pow(w-q[i][0],2)+Math.pow(x-q[i][1],2)<=c)for(j in s[i])u.lat+=b[j].latLng.lat(),u.lng+=b[j].latLng.lng(),u.idx.push(j)}u.lat/=u.idx.length,u.lng/=u.idx.length,r?(v=u.idx.length>r.idx.length,v&&(r=u)):(v=u.idx.length>1,r=u),v&&(k=f.fromLatLngToPoint(new google.maps.LatLng(r.lat,r.lng)),w=Math.floor((k.x-g.x)*Math.pow(2,p)),x=Math.floor((k.y-g.y)*Math.pow(2,p)))}while(v);for(o=0;o<r.idx.length;o++)r.idx[o]in s&&delete s[r.idx[o]];t.push(r)}return t},this.getBounds=function(){var a,c=new google.maps.LatLngBounds;for(a=0;a<b.length;a++)c.extend(b[a].latLng);return c}}function j(b){for(var c in b)typeof e[c]=="object"?e[c]=a.extend({},e[c],b[c]):e[c]=b[c]}function l(a){if(!a)return!0;for(var b=0;b<g.length;b++)if(g[b]===a)return!1;return!0}function m(a){var b=o(a,"action");for(var c=0;c<h.length;c++)if(h[c]===b)return!0;return!1}function n(a,b){if(b.toLowerCase){b=b.toLowerCase();for(var c in a)if(c.toLowerCase&&c.toLowerCase()==b)return c}return!1}function o(a,b,c){var d=n(a,b);return d?a[d]:c}function p(a,b){var c,d;if(!a||!b)return!1;b=z(b);for(c in a)if(c.toLowerCase){c=c.toLowerCase();for(d in b)if(c==b[d])return!0}return!1}function q(a,b,c){if(p(a,f)||p(a,b)){var d,e;for(d=0;d<f.length;d++)e=n(a,f[d]),c[f[d]]=e?a[e]:{};if(b&&b.length)for(d=0;d<b.length;d++)if(e=n(a,b[d]))c[b[d]]=a[e];return c}c.options={};for(e in a)e!=="action"&&(c.options[e]=a[e]);return c}function r(a,b,c,d){var e=n(b,a),g,h={},i=["map"];h.callback=o(b,"callback"),c=z(c),d=z(d);if(e)return q(b[e],c,h);if(d&&d.length)for(g=0;g<d.length;g++)i.push(d[g]);p(b,i)||(h=q(b,c,h));for(g=0;g<f.length;g++){if(f[g]in h)continue;h[f[g]]={}}return h}function s(){return i||(i=new google.maps.Geocoder),i}function t(){return directionsService||(directionsService=new google.maps.DirectionsService),directionsService}function u(){return elevationService||(elevationService=new google.maps.ElevationService),elevationService}function v(){return maxZoomService||(maxZoomService=new google.maps.MaxZoomService),maxZoomService}function w(){return distanceMatrixService||(distanceMatrixService=new google.maps.DistanceMatrixService),distanceMatrixService}function x(a){return(typeof a=="number"||typeof a=="string")&&a!==""&&!isNaN(a)}function z(a){var b,c=[];if(a!==undefined)if(typeof a=="object")if(typeof a.length=="number")c=a;else for(b in a)c.push(a[b]);else c.push(a);return c}function A(a,b,c){var d=b?a:null;return!a||typeof a=="string"?d:a.latLng?A(a.latLng):typeof a.lat=="function"?a:x(a.lat)?new google.maps.LatLng(a.lat,a.lng):!c&&a.length?!x(a[0])||!x(a[1])?d:new google.maps.LatLng(a[0],a[1]):d}function B(a,b,c){var d,e,f;return a?(f=c?a:null,typeof a.getCenter=="function"?a:(a.length?a.length==2?(d=A(a[0]),e=A(a[1])):a.length==4&&(d=A([a[0],a[1]]),e=A([a[2],a[3]])):"ne"in a&&"sw"in a?(d=A(a.ne),e=A(a.sw)):"n"in a&&"e"in a&&"s"in a&&"w"in a&&(d=A([a.n,a.e]),e=A([a.s,a.w])),d&&e?new google.maps.LatLngBounds(e,d):f)):null}function C(f){var g=new b,h=new c,i=null,m={},n=!1;this._plan=function(a){for(var b=0;b<a.length;b++)g.add(a[b]);this._run()},this._planNext=function(a){g.addNext(a)},this._direct=function(b){var c=o(b,"action");return this[c](a.extend({},c in e?e[c]:{},b.args?b.args:b))},this._end=function(){n=!1,g.ack(),this._run()},this._run=function(){if(n)return;var a=g.get();if(!a)return;n=!0,this._proceed(a)},this._proceed=function(b){b=b||{};var c=o(b,"action")||"init",d=c.toLowerCase(),f=!0,g=o(b,"target"),h=o(b,"args"),j;!i&&l(d)&&this.init(a.extend({},e.init,b.args&&b.args.map?b.args.map:b.map?b.map:{}),!0);if(!g&&!h&&d in this&&typeof this[d]=="function")this[d](a.extend({},d in e?e[d]:{},b.args?b.args:b));else{if(g&&typeof g=="object"){if(f=typeof g[c]=="function")j=g[c].apply(g,b.args?b.args:[])}else i&&(f=typeof i[c]=="function")&&(j=i[c].apply(i,b.args?b.args:[]));!f&&e.verbose&&alert("unknown action : "+c),this._callback(j,b),this._end()}},this._resolveLatLng=function(a,b,c,d){var f=o(a,"address"),g,h=this;f?(d||(d=0),typeof f=="object"?g=f:g={address:f},s().geocode(g,function(f,g){g===google.maps.GeocoderStatus.OK?h[b](a,c?f:f[0].geometry.location):g===google.maps.GeocoderStatus.OVER_QUERY_LIMIT&&d<e.queryLimit.attempt?setTimeout(function(){h._resolveLatLng(a,b,c,d+1)},e.queryLimit.delay+Math.floor(Math.random()*e.queryLimit.random)):(e.verbose&&alert("Geocode error : "+g),h[b](a,!1))})):h[b](a,A(a,!1,!0))},this._call=function(){var a,b=arguments[0],c=[];if(!arguments.length||!i||typeof i[b]!="function")return;for(a=1;a<arguments.length;a++)c.push(arguments[a]);return i[b].apply(i,c)},this._subcall=function(b,c){var d={};if(!b.map)return;c||(c=o(b.map,"latlng")),i?(b.map.center&&c&&this._call("setCenter",c),b.map.zoom!==undefined&&this._call("setZoom",b.map.zoom),b.map.mapTypeId!==undefined&&this._call("setMapTypeId",b.map.mapTypeId)):(c&&(d={center:c}),this.init(a.extend({},b.map,d),!0))},this._attachEvent=function(a,b,c,d,e){google.maps.event["addListener"+(e?"Once":"")](a,b,function(b){c.apply(f,[a,b,d])})},this._attachEvents=function(a,b){var c;if(!b)return;if(b.events)for(c in b.events)typeof b.events[c]=="function"&&this._attachEvent(a,c,b.events[c],b.data,!1);if(b.onces)for(c in b.onces)typeof b.onces[c]=="function"&&this._attachEvent(a,c,b.onces[c],b.data,!0)},this._callback=function(a,b){if(typeof b.callback=="function")b.callback.apply(f,[a]);else if(typeof b.callback=="object")for(var c=0;c<b.callback.length;c++)typeof b.callback[c]=="function"&&b.callback[k].apply(f,[a])},this._manageEnd=function(a,b,c){var d,e;if(a&&typeof a=="object"){this._attachEvents(a,b);if(b.apply&&b.apply.length)for(d=0;d<b.apply.length;d++){e=b.apply[d];if(!e.action||typeof a[e.action]!="function")continue;e.args?a[e.action].apply(a,e.args):a[e.action]()}}c||(this._callback(a,b),this._end())},this.destroy=function(a){var b;h.clear(),f.empty();for(b in m)delete m[b];m={},i&&delete i,this._callback(f,null,a),this._end()},this.init=function(b,c){var d,g;if(i)return this._end();d=r("map",b);if(typeof d.options.center=="boolean"&&d.options.center)return!1;opts=a.extend({},e.init,d.options),opts.center||(opts.center=[e.init.center.lat,e.init.center.lng]),opts.center=A(opts.center),i=new e.classes.Map(f.get(0),opts);for(g in m)i.mapTypes.set(g,m[g]);return this._manageEnd(i,d,c),!0},this.getlatlng=function(a){this._resolveLatLng(a,"_getLatLng",!0)},this._getLatLng=function(a,b){this._manageEnd(b,a)},this.getaddress=function(a){var b=A(a,!1,!0),c=o(a,"address"),d=b?{latLng:b}:c?typeof c=="string"?{address:c}:c:null,e=o(a,"callback");d&&typeof e=="function"&&s().geocode(d,function(a,b){var c=b===google.maps.GeocoderStatus.OK?a:!1;e.apply(f,[c,b])}),this._end()},this.getroute=function(a){var b=o(a,"callback");typeof b=="function"&&a.options&&(a.options.origin=A(a.options.origin,!0),a.options.destination=A(a.options.destination,!0),t().route(a.options,function(a,c){var d=c==google.maps.DirectionsStatus.OK?a:!1;b.apply(f,[d,c])})),this._end()},this.getelevation=function(a){var b,c,d,e,g,h=[],i=o(a,"callback"),c=o(a,"latlng");if(typeof i=="function"){b=function(a,b){var c=b===google.maps.ElevationStatus.OK?a:!1;i.apply(f,[c,b])};if(c)h.push(A(c));else{h=o(a,"locations")||[];if(h){h=z(h);for(g=0;g<h.length;g++)h[g]=A(h[g])}}if(h.length)u().getElevationForLocations({locations:h},b);else{d=o(a,"path"),e=o(a,"samples");if(d&&e){for(g=0;g<d.length;g++)h.push(A(d[g]));h.length&&u().getElevationAlongPath({path:h,samples:e},b)}}}this._end()},this.getdistance=function(a){var b,c=o(a,"callback");if(typeof c=="function"&&a.options&&a.options.origins&&a.options.destinations){a.options.origins=z(a.options.origins);for(b=0;b<a.options.origins.length;b++)a.options.origins[b]=A(a.options.origins[b],!0);a.options.destinations=z(a.options.destinations);for(b=0;b<a.options.destinations.length;b++)a.options.destinations[b]=A(a.options.destinations[b],!0);w().getDistanceMatrix(a.options,function(a,b){var d=b==google.maps.DistanceMatrixStatus.OK?a:!1;c.apply(f,[d,b])})}},this.addmarker=function(a){this._resolveLatLng(a,"_addMarker")},this._addMarker=function(a,b,c){var d,f,g,j=r("marker",a,"to");if(!c){if(!b){this._manageEnd(!1,j);return}this._subcall(a,b)}else if(!b)return;if(j.to)g=h.refToObj(j.to),d=g&&typeof g.add=="function",d&&(g.add(b,a),typeof g.redraw=="function"&&g.redraw()),c||this._manageEnd(d,j);else{j.options.position=b,j.options.map=i,d=new e.classes.Marker(j.options);if(p(a,"infowindow")){f=r("infowindow",a.infowindow,"open");if(f.open===undefined||f.open)f.apply=z(f.apply),f.apply.unshift({action:"open",args:[i,d]});f.action="addinfowindow",this._planNext(f)}c||(h.add("marker",d,j),this._manageEnd(d,j))}return d},this.addmarkers=function(a){o(a,"clusters")?this._addclusteredmarkers(a):this._addmarkers(a)},this._addmarkers=function(b){var c,d,f,g,j,k={},l,m,n=o(b,"markers");this._subcall(b);if(typeof n!="object")return this._end();d=r("marker",b,["to","markers"]);if(d.to){m=h.refToObj(d.to),c=m&&typeof m.add=="function";if(c){for(f=0;f<n.length;f++)(g=A(n[f]))&&m.add(g,n[f]);typeof m.redraw=="function"&&m.redraw()}this._manageEnd(c,d)}else{a.extend(!0,k,d.options),k.map=i,c=[];for(f=0;f<n.length;f++)if(g=A(n[f]))n[f].options?(l={},a.extend(!0,l,k,n[f].options),d.options=l):d.options=k,d.options.position=g,j=new e.classes.Marker(d.options),c.push(j),d.data=n[f].data,d.tag=n[f].tag,h.add("marker",j,d),this._manageEnd(j,d,!0);d.options=k,this._callback(c,b),this._end()}},this._addclusteredmarkers=function(a){var b,c,e,f,g=this,h=o(a,"radius"),j=o(a,"markers"),k=o(a,"clusters");if(!i.getBounds()){google.maps.event.addListenerOnce(i,"bounds_changed",function(){g._addclusteredmarkers(a)});return}if(typeof h=="number"){b=new d;for(c=0;c<j.length;c++)e=A(j[c]),b.add(e,j[c]);f=this._initClusters(a,b,h,k)}this._callback(f,a),this._end()},this._initClusters=function(a,b,c,d){var e=this;return b.setRedraw(function(f){var g,h=b.clusters(i,c,f);h&&(g=b.freeDiff(h),e._displayClusters(a,b,h,g,d))}),b.events(google.maps.event.addListener(i,"zoom_changed",function(){b.redraw(!0)}),google.maps.event.addListener(i,"bounds_changed",function(){b.redraw()})),b.redraw(),h.add("cluster",b,a)},this._displayClusters=function(b,c,d,e,f){var g,h,i,j,k,l,m,n,q,s,t,u,v,w=p(b,"cluster")?r("",o(b,"cluster")):{},x=p(b,"marker")?r("",o(b,"marker")):{};for(h=0;h<d.length;h++){if(h in e)continue;n=d[h],k=!1;if(n.idx.length>1){j=0;for(g in f)g>j&&g<=n.idx.length&&(j=g);if(f[j]){t=o(f[j],"width"),u=o(f[j],"height"),v={},a.extend(!0,v,w,{options:{pane:"overlayLayer",content:f[j].content.replace("CLUSTER_COUNT",n.idx.length),offset:{x:-t/2,y:-u/2}}}),l=this._addOverlay(v,A(n),!0),v.options.pane="floatShadow",v.options.content=a("<div></div>"),v.options.content.width(t),v.options.content.height(u),m=this._addOverlay(v,A(n),!0),w.data={latLng:A(n),markers:[]};for(i=0;i<n.idx.length;i++)w.data.markers.push(c.get(n.idx[i]).marker);this._attachEvents(m,w),c.store(n,l,m),k=!0}}if(!k){q={},a.extend(!0,q,x.options);for(i=0;i<n.idx.length;i++)j=c.get(n.idx[i]),x.latLng=j.latLng,x.data=j.marker.data,x.tag=j.marker.tag,j.marker.options?(s={},a.extend(!0,s,q,j.marker.options),x.options=s):x.options=q,l=this._addMarker(x,x.latLng,!0),this._attachEvents(l,x),c.store(n,l);x.options=q}}},this.addinfowindow=function(a){this._resolveLatLng(a,"_addInfoWindow")},this._addInfoWindow=function(a,b){var c,d,f=[];this._subcall(a,b),c=r("infowindow",a,["open","anchor"]),b&&(c.options.position=b),d=new e.classes.InfoWindow(c.options);if(c.open===undefined||c.open)c.apply=z(c.apply),f.push(i),c.anchor&&f.push(c.anchor),c.apply.unshift({action:"open",args:f});h.add("infowindow",d,c),this._manageEnd(d,c)},this.addpolyline=function(a){this._addPoly(a,"Polyline","path")},this.addpolygon=function(a){this._addPoly(a,"Polygon","paths")},this._addPoly=function(a,b,c){var d,e,f,g=r(b.toLowerCase(),a,c);if(g[c]){g.options[c]=[];for(d=0;d<g[c].length;d++)(f=A(g[c][d]))&&g.options[c].push(f)}e=new google.maps[b](g.options),e.setMap(i),h.add(b.toLowerCase(),e,g),this._manageEnd(e,g)},this.addcircle=function(a){this._resolveLatLng(a,"_addCircle")},this._addCircle=function(a,b){var c,d=r("circle",a);b||(b=A(d.options.center));if(!b)return this._manageEnd(!1,d);this._subcall(a,b),d.options.center=b,d.options.map=i,c=new e.classes.Circle(d.options),h.add("circle",c,d),this._manageEnd(c,d)},this.addrectangle=function(a){this._resolveLatLng(a,"_addRectangle")},this._addRectangle=function(a,b){var c,d=r("rectangle",a);d.options.bounds=B(d.options.bounds,!0);if(!d.options.bounds)return this._manageEnd(!1,d);this._subcall(a,d.options.bounds.getCenter()),d.options.map=i,c=new e.classes.Rectangle(d.options),h.add("rectangle",c,d),this._manageEnd(c,d)},this.addoverlay=function(a){this._resolveLatLng(a,"_addOverlay")},this._addOverlay=function(b,c,d){function m(){e.classes.OverlayView.call(this),this.setMap(i)}var f,g=r("overlay",b),j=a.extend({pane:"floatPane",content:"",offset:{x:0,y:0}},g.options),k=a("<div></div>"),l=[];return k.css("border","none").css("borderWidth","0px").css("position","absolute"),k.append(j.content),m.prototype=new e.classes.OverlayView,m.prototype.onAdd=function(){var b=this.getPanes();j.pane in b&&a(b[j.pane]).append(k)},m.prototype.draw=function(){var b=this.getProjection(),d=b.fromLatLngToDivPixel(c),e=this;k.css("left",d.x+j.offset.x+"px").css("top",d.y+j.offset.y+"px"),a.each("dblclick click mouseover mousemove mouseout mouseup mousedown".split(" "),function(a,b){l.push(google.maps.event.addDomListener(k[0],b,function(a){google.maps.event.trigger(e,b)}))}),l.push(google.maps.event.addDomListener(k[0],"contextmenu",function(a){google.maps.event.trigger(e,"rightclick")}))},m.prototype.onRemove=function(){for(var a=0;a<l.length;a++)google.maps.event.removeListener(l[a]);k.remove()},m.prototype.hide=function(){k.hide()},m.prototype.show=function(){k.show()},m.prototype.toggle=function(){k&&(k.is(":visible")?this.show():this.hide())},m.prototype.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(i)},m.prototype.getDOMElement=function(){return k[0]},f=new m,d||(h.add("overlay",f,g),this._manageEnd(f,g)),f},this.addfixpanel=function(b){var c=r("fixpanel",b),d=y=0,e,g;c.options.content&&(e=a(c.options.content),c.options.left!==undefined?d=c.options.left:c.options.right!==undefined?d=f.width()-e.width()-c.options.right:c.options.center&&(d=(f.width()-e.width())/2),c.options.top!==undefined?y=c.options.top:c.options.bottom!==undefined?y=f.height()-e.height()-c.options.bottom:c.options.middle&&(y=(f.height()-e.height())/2),g=a("<div></div>").css("position","absolute").css("top",y+"px").css("left",d+"px").css("z-index","1000").append(e),f.first().prepend(g),this._attachEvents(i,c),h.add("fixpanel",g,c),this._callback(g,c)),this._end()},this.adddirectionsrenderer=function(a,b){var c,d=r("directionrenderer",a,"panelId");return h.rm("directionrenderer"),d.options.map=i,c=new google.maps.DirectionsRenderer(d.options),d.panelId&&c.setPanel(document.getElementById(d.panelId)),h.add("directionrenderer",c,d),this._manageEnd(c,d,b),c},this.setdirectionspanel=function(a){var b=h.get("directionrenderer"),c=r("directionpanel",a,"id");b&&c.id&&b.setPanel(document.getElementById(c.id)),this._manageEnd(b,c)},this.setdirections=function(a){var b=h.get("directionrenderer"),c=r("directions",a);a&&(c.options.directions=a.directions?a.directions:a.options&&a.options.directions?a.options.directions:null),c.options.directions&&(b?b.setDirections(c.options.directions):b=this.adddirectionsrenderer(c,!0)),this._manageEnd(b,c)},this.setstreetview=function(a){var b,c=r("streetview",a,"id");c.options.position&&(c.options.position=A(c.options.position)),b=new e.classes.StreetViewPanorama(document.getElementById(c.id),c.options),b&&i.setStreetView(b),this._manageEnd(b,c)},this.addkmllayer=function(a){var b,c=r("kmllayer",a,"url");c.options.map=i,typeof c.url=="string"&&(b=new e.classes.KmlLayer(c.url,c.options)),h.add("kmllayer",b,c),this._manageEnd(b,c)},this.addtrafficlayer=function(a){var b=r("trafficlayer",a),c=h.get("trafficlayer");c||(c=new e.classes.TrafficLayer,c.setMap(i),h.add("trafficlayer",c,b)),this._manageEnd(c,b)},this.addbicyclinglayer=function(a){var b=r("bicyclinglayer",a),c=h.get("bicyclinglayer");c||(c=new e.classes.BicyclingLayer,c.setMap(i),h.add("bicyclinglayer",c,b)),this._manageEnd(c,b)},this.addgroundoverlay=function(a){var b,c=r("groundoverlay",a,["bounds","url"]);c.bounds=B(c.bounds),c.bounds&&typeof c.url=="string"&&(b=new e.classes.GroundOverlay(c.url,c.bounds),b.setMap(i),h.add("groundoverlay",b,c)),this._manageEnd(b,c)},this.geolatlng=function(a){var b=o(a,"callback");typeof b=="function"&&(navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){var c=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);b.apply(f,[c])},function(){var a=!1;b.apply(f,[a])}):google.gears?google.gears.factory.create("beta.geolocation").getCurrentPosition(function(a){var c=new google.maps.LatLng(a.latitude,a.longitude);b.apply(f,[c])},function(){out=!1,b.apply(f,[out])}):b.apply(f,[!1])),this._end()},this.addstyledmap=function(a,b){var c=r("styledmap",a,["id","style"]);c.style&&c.id&&!m[c.id]&&(m[c.id]=new e.classes.StyledMapType(c.style,c.options),i&&i.mapTypes.set(c.id,m[c.id])),this._manageEnd(m[c.id],c,b)},this.setstyledmap=function(a){var b=r("styledmap",a,["id","style"]);b.id&&(this.addstyledmap(b,!0),m[b.id]&&(i.setMapTypeId(b.id),this._callback(m[b.id],a))),this._manageEnd(m[b.id],b)},this.clear=function(a){var b=z(o(a,"list")||o(a,"name")),c=o(a,"last",!1),d=o(a,"first",!1),e=o(a,"tag");e!==undefined&&(e=z(e)),h.clear(b,c,d,e),this._end()},this.get=function(a){var b=o(a,"name")||"map",c=o(a,"first"),d=o(a,"all"),e=o(a,"tag");return b=b.toLowerCase(),b==="map"?i:(e!==undefined&&(e=z(e)),c?h.get(b,!1,e):d?h.all(b,e):h.get(b,!0,e))},this.getmaxzoom=function(a){this._resolveLatLng(a,"_getMaxZoom")},this._getMaxZoom=function(a,b){var c=o(a,"callback");c&&typeof c=="function"&&v().getMaxZoomAtLatLng(b,function(a){var b=a.status===google.maps.MaxZoomStatus.OK?a.zoom:!1;c.apply(f,[b,a.status])}),this._end()},this.setdefault=function(a){j(a),this._end()},this.autofit=function(a,b){var c,d,e,f,g,j=!0,k=new google.maps.LatLngBounds;c=h.names();for(f=0;f<c.length;f++){d=h.all(c[f]);for(g=0;g<d.length;g++)e=d[g],e.getPosition?(k.extend(e.getPosition()),j=!1):e.getBounds?(k.extend(e.getBounds().getNorthEast()),k.extend(e.getBounds().getSouthWest()),j=!1):e.getPaths?e.getPaths().forEach(function(a){a.forEach(function(a){k.extend(a),j=!1})}):e.getPath?e.getPath().forEach(function(a){k.extend(a),j=!1}):e.getCenter&&(k.extend(e.getCenter()),j=!1)}j||i.fitBounds(k),b||this._manageEnd(j?!1:k,a,b)}}var e={verbose:!1,queryLimit:{attempt:5,delay:250,random:250},init:{mapTypeId:google.maps.MapTypeId.ROADMAP,center:[46.578498,2.457275],zoom:2},classes:{Map:google.maps.Map,Marker:google.maps.Marker,InfoWindow:google.maps.InfoWindow,Circle:google.maps.Circle,Rectangle:google.maps.Rectangle,OverlayView:google.maps.OverlayView,StreetViewPanorama:google.maps.StreetViewPanorama,KmlLayer:google.maps.KmlLayer,TrafficLayer:google.maps.TrafficLayer,BicyclingLayer:google.maps.BicyclingLayer,GroundOverlay:google.maps.GroundOverlay,StyledMapType:google.maps.StyledMapType}},f=["events","onces","options","apply","callback","data","tag"],g=["init","geolatlng","getlatlng","getroute","getelevation","getdistance","addstyledmap","setdefault","destroy"],h=["get"],i=directionsService=elevationService=maxZoomService=distanceMatrixService=null;a.fn.gmap3=function(){var b,c,d=[],e=!0,f=[];for(b=0;b<arguments.length;b++)c=arguments[b]||{},typeof c=="string"&&(c={action:c}),d.push(c);return d.length||d.push({}),a.each(this,function(){var b=a(this),c=b.data("gmap3");e=!1,c||(c=new C(b),b.data("gmap3",c)),d.length==1&&m(d[0])?f.push(c._direct(d[0])):c._plan(d)}),f.length?f.length===1?f[0]:f:(e&&arguments.length==2&&typeof arguments[0]=="string"&&arguments[0].toLowerCase()==="setdefault"&&j(arguments[1]),this)}})(jQuery)